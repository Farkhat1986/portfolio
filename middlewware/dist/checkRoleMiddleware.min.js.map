{"version":3,"sources":["checkRoleMiddleware.js"],"names":["_jsonwebtoken","_interopRequireDefault","require","_dotenv","config","secret","process","env","SECRET_KEY","checkRoleMiddleware","role","req","res","next","method","token","headers","authorization","split","status","json","message","jwt","decoded","user","e"],"mappings":"oHAAA,IAAAA,cAAAC,uBAAAC,QAAA,iBACAC,QAAAD,QAAA,mFAEA,EAAAC,QAAAC,UACA,IAAMC,OAASC,QAAQC,IAAIC,WAJ3B,SAAAC,oBAAAC,GAQI,OAAO,SAAUC,EAAKC,EAAKC,GAP/B,YAAAF,EAAAG,QASYD,IAEJ,IATR,IAAAE,EAAAJ,EAAAK,QAAAC,cAAAC,MAAA,KAAA,GACY,IAAGZ,EAEf,OAAAM,EAAAO,OAAA,KAAAC,KAAA,CAAAC,QAAA,oBACgBZ,IAAAA,EAATa,cAAAA,QAA8BZ,OAAMK,EAAAV,QAChC,GAAAkB,EAAAb,OAAoBG,EAChBC,OAAWF,EAAAO,OAAW,KAAAC,KAAA,CAAAC,QAAA,oBAE5BV,EAAAa,KAAAD,EAWGV,IAVA,MAAAY,GACMV,EAAKI,OAAOH,KAAAA,KAAQC,CAAAA,QAAcC","file":"checkRoleMiddleware.min.js","sourcesContent":["import jwt from 'jsonwebtoken'\r\nimport { config } from 'dotenv'\r\n\r\nconfig()\r\nconst secret = process.env.SECRET_KEY;\r\n\r\n/** Проверка роли пользователя. */\r\nexport function checkRoleMiddleware (role) {\r\n    return function (req, res, next) {\r\n        if(req.method === \"OPTIONS\") {\r\n            next();\r\n        }\r\n        try {\r\n            const token = req.headers.authorization.split(' ')[1]; //Bearer token\r\n            if(!token) {\r\n                return res.status(401).json({ message: \"НЕТ ДОСТУПА !!!\"});\r\n            }\r\n            const decoded = jwt.verify(token, secret);\r\n            if(decoded.role !== role) {\r\n                return res.status(403).json({ message: \"НЕТ ДОСТУПА !!!\"})\r\n            }\r\n            req.user = decoded;\r\n            next();\r\n        } catch(e) {\r\n            res.status(401).json({ message: \"НЕТ ДОСТУПА !!!\"});\r\n        }\r\n    }\r\n}"]}