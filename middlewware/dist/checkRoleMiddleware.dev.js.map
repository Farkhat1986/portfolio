{"version":3,"sources":["checkRoleMiddleware.js"],"names":["secret","process","env","SECRET_KEY","checkRoleMiddleware","role","req","res","next","method","token","headers","authorization","split","status","json","message","decoded","jwt","verify","user","e"],"mappings":";;;;;;;AAAA;;AACA;;;;AAEA;AACA,IAAMA,MAAM,GAAGC,OAAO,CAACC,GAAR,CAAYC,UAA3B;AAEA;;AACO,SAASC,mBAAT,CAA8BC,IAA9B,EAAoC;AACvC,SAAO,UAAUC,GAAV,EAAeC,GAAf,EAAoBC,IAApB,EAA0B;AAC7B,QAAGF,GAAG,CAACG,MAAJ,KAAe,SAAlB,EAA6B;AACzBD,MAAAA,IAAI;AACP;;AACD,QAAI;AACA,UAAME,KAAK,GAAGJ,GAAG,CAACK,OAAJ,CAAYC,aAAZ,CAA0BC,KAA1B,CAAgC,GAAhC,EAAqC,CAArC,CAAd,CADA,CACuD;;AACvD,UAAG,CAACH,KAAJ,EAAW;AACP,eAAOH,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,UAAAA,OAAO,EAAE;AAAX,SAArB,CAAP;AACH;;AACD,UAAMC,OAAO,GAAGC,yBAAIC,MAAJ,CAAWT,KAAX,EAAkBV,MAAlB,CAAhB;;AACA,UAAGiB,OAAO,CAACZ,IAAR,KAAiBA,IAApB,EAA0B;AACtB,eAAOE,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,UAAAA,OAAO,EAAE;AAAX,SAArB,CAAP;AACH;;AACDV,MAAAA,GAAG,CAACc,IAAJ,GAAWH,OAAX;AACAT,MAAAA,IAAI;AACP,KAXD,CAWE,OAAMa,CAAN,EAAS;AACPd,MAAAA,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAArB;AACH;AACJ,GAlBD;AAmBH","sourcesContent":["import jwt from 'jsonwebtoken'\r\nimport { config } from 'dotenv'\r\n\r\nconfig()\r\nconst secret = process.env.SECRET_KEY;\r\n\r\n/** Проверка роли пользователя. */\r\nexport function checkRoleMiddleware (role) {\r\n    return function (req, res, next) {\r\n        if(req.method === \"OPTIONS\") {\r\n            next();\r\n        }\r\n        try {\r\n            const token = req.headers.authorization.split(' ')[1]; //Bearer token\r\n            if(!token) {\r\n                return res.status(401).json({ message: \"НЕТ ДОСТУПА !!!\"});\r\n            }\r\n            const decoded = jwt.verify(token, secret);\r\n            if(decoded.role !== role) {\r\n                return res.status(403).json({ message: \"НЕТ ДОСТУПА !!!\"})\r\n            }\r\n            req.user = decoded;\r\n            next();\r\n        } catch(e) {\r\n            res.status(401).json({ message: \"НЕТ ДОСТУПА !!!\"});\r\n        }\r\n    }\r\n}"],"file":"checkRoleMiddleware.dev.js"}