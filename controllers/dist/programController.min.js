"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.programController=void 0;var _model=require("../model/model.js"),_uuid=require("uuid"),_path=require("path"),_ApiError=require("../error/ApiError.js");function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}var ProgramController=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"create",value:function(r,t,n){var a,o,i,s,u,c,l,p,d;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=r.body,o=a.name,i=a.description,s=a.price,u=a.categoriesId,c=a.tehnoId,l=r.files.image,p=(0,_uuid.v4)()+".jpg",l.mv((0,_path.resolve)((0,_path.resolve)((0,_path.dirname)("")),"static",p)),e.next=7,regeneratorRuntime.awrap(_model.Program.create({name:o,description:i,price:s,categoriesId:u,tehnoId:c,image:p}));case 7:return d=e.sent,e.abrupt("return",t.json(d));case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",n(_ApiError.ApiError.badRequest(e.t0.message)));case 14:case"end":return e.stop()}},null,null,[[0,11]])}},{key:"getAll",value:function(r,t){var n,a,o,i,s,u,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.query,a=n.categoriesId,o=n.tehnoId,i=n.limit,s=n.page,u=(s=s||1)*(i=i||10)-i,a||o){e.next=8;break}return e.next=7,regeneratorRuntime.awrap(_model.Program.findAndCountAll());case 7:c=e.sent;case 8:if(!a&&o)return e.next=11,regeneratorRuntime.awrap(_model.Program.findAndCountAll({where:{tehnoId:o},limit:i,offset:u}));e.next=12;break;case 11:c=e.sent;case 12:if(a&&!o)return e.next=15,regeneratorRuntime.awrap(_model.Program.findAndCountAll({where:{categoriesId:a},limit:i,offset:u}));e.next=16;break;case 15:c=e.sent;case 16:if(a&&o)return e.next=19,regeneratorRuntime.awrap(_model.Program.findAndCountAll({where:{categoriesId:a,tehnoId:o},limit:i,offset:u}));e.next=20;break;case 19:c=e.sent;case 20:return e.abrupt("return",t.json(c));case 21:case"end":return e.stop()}})}},{key:"getOne",value:function(r,t){var n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.params.id,e.next=3,regeneratorRuntime.awrap(_model.Program.findOne({where:{id:n}}));case 3:return a=e.sent,e.abrupt("return",t.json(a));case 5:case"end":return e.stop()}})}}]),e}(),programController=new ProgramController;exports.programController=programController;
//# sourceMappingURL=programController.min.js.map
